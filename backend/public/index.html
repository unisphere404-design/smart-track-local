<!DOCTYPE html>
<html>
<head>
  <title>Socket.IO Test</title>
</head>
<body>
  <h1>Backend Test</h1>
  <div id="status">Connecting...</div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io();

    socket.on('connect', () => {
      document.getElementById('status').textContent = 'Connected to backend';
    });

    socket.on('location-update', (data) => {
      console.log('Location update:', data);
    });
  </script>
</body>
</html>


<!-- 
<!DOCTYPE html>
<html>
<head>
  <title>Bus Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha512-sA+e2t1rbK6koy0DYCD3HyBA0FwAcU+BrnzXBZ7wVvh1HRs67M6StnQdXxvVqxKSlYkz9Iz4bW9ntF2zC1GpLw=="
    crossorigin=""
  />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha512-pvF+fMb7l9kD+cJSR6UcJLmwBbzGmZm1hGpKQJ3z+tM0fzjxV61RM6I0+dCHr6eOYzoC5JkY3oF4kUNXk8ZfIw=="
    crossorigin=""></script>

  <script>
    const socket = io();
    let myBusId = null;

    const iconUrls = {
      host: 'https://maps.gstatic.com/mapfiles/ms2/micons/red-dot.png',
      bus1: 'https://maps.gstatic.com/mapfiles/ms2/micons/purple-dot.png',
      bus2: 'https://maps.gstatic.com/mapfiles/ms2/micons/blue-dot.png',
      bus3: 'https://maps.gstatic.com/mapfiles/ms2/micons/orange-dot.png',
      bus4: 'https://maps.gstatic.com/mapfiles/ms2/micons/pink-dot.png',
    };

    const icons = {};
    for (let key in iconUrls) {
      icons[key] = new L.Icon({
        iconUrl: iconUrls[key],
        iconSize: [32, 32],
        iconAnchor: [16, 32]
      });
    }

    const map = L.map('map', {
      center: [28.6139, 77.2090],
      zoom: 13,
      minZoom: 5,
      maxZoom: 19
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const markers = {};

    socket.on('init', ({ busId, locations }) => {
      myBusId = busId;
      console.log('Assigned:', myBusId);

      updateMarkers(locations);

      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
          (position) => {
            const coords = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            socket.emit('bus-location', coords);
          },
          (err) => {
            console.error("Geolocation error", err);
            alert("Enable location to track bus.");
          },
          {
            enableHighAccuracy: true,
            maximumAge: 0,
            timeout: 5000
          }
        );
      } else {
        alert("Geolocation not supported.");
      }

      setTimeout(() => map.invalidateSize(), 500);
    });

    socket.on('location-update', (locations) => {
      updateMarkers(locations);
    });

    function updateMarkers(locData) {
      for (const key in locData) {
        const loc = locData[key];

        if (loc && isValidCoords(loc.lat, loc.lng)) {
          if (!markers[key]) {
            markers[key] = L.marker([loc.lat, loc.lng], { icon: icons[key] })
              .addTo(map)
              .bindPopup(key === 'host' ? 'Laptop (Host)' : key.toUpperCase());
          } else {
            markers[key].setLatLng([loc.lat, loc.lng]);
          }

          // Auto-center map on own location (once)
          if (key === myBusId && map._zoom < 12) {
            map.setView([loc.lat, loc.lng], 15);
          }

        } else {
          // Remove marker if location is null or invalid
          if (markers[key]) {
            map.removeLayer(markers[key]);
            delete markers[key];
          }
        }
      }

      // Always invalidate to avoid blank screen
      setTimeout(() => map.invalidateSize(), 200);
    }

    function isValidCoords(lat, lng) {
      return typeof lat === 'number' &&
             typeof lng === 'number' &&
             lat >= -90 && lat <= 90 &&
             lng >= -180 && lng <= 180;
    }
  </script>
</body>
</html> --> -->
